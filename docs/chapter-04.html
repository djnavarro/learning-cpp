<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <meta name="generator" content="pandoc">
      
      
      <title>4: Designing professional C++ programs</title>
      <!-- Bootstrap -->
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
      <!-- Font-awesome -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      <!-- Styles -->
      <link rel="stylesheet" href="style.css">
         </head>
   <body>
            <div class="container">
         <h1 class="title">4: Designing professional C++ programs</h1>
                  <div class="row">
            <div class="col-xl-10"><p><a href="index.html">Back to top</a></p>
<h2 id="chapter-summary">Chapter summary</h2>
<p>…Blah blah blah. I’ll fill this bit in later…</p>
<p>Okay, so most of this makes sense to me. Fundamentally, the point is that if you’re building software rather than writing a script, it’s a good idea to spend time sketching out what you think the structure of that software is, <em>before</em> you start writing any code.</p>
<p>A design document that specifies this plan might start out as a basic sketch. As you put together the sketch you’ll start fleshing out specific classes, their methods and fields, and the ways they interact. It’s an iterative process: you might realise some parts of your plan are wrong, redesign, etc.</p>
<h2 id="an-informal-sketch">An informal sketch</h2>
<p>Something I’ve always wanted to do is write a simple game engine for simple text-based games, kind of like the “choose your own adventure” novels and “fighting fantasy” novels I used to read as a kid, or the kind of “twine” games I used to see on the web. Not that the world needs another one of those things, of course, but I kind of want to do it just for fun. So let’s imagine something like that. How would I design a game engine like this? It’s not a very complicated piece of software, but it would still have quite a few moving parts.</p>
<p>The first step is to start writing an informal list of what some of the parts would be. At this point I’m not thinking about specific classes, and I’m not being at all precise about what the parts do and how they interact. This first stage is purely an exercise in me trying think about what kinds of things I’ll need to include in the program.</p>
<p>Let’s start by considering the “people, places, and things” that might be involved in a specific game:</p>
<ul>
<li><p>We would need a <strong>Protagonist</strong> object to represent the player character (there would be only one of these). The protagonist would need to have fields to store relevant information about the current state of the character (current health, maximum health, current hunger, current strength, etc). The protagonist object would be responsible for various actions associated with the state of the character. For instance, it should signal the end of the game if health reaches zero, it should decrease health if hunger gets too high, and so on. The <strong>Protagonist</strong> object would also be responsible for those game state variables that represent “where the protagonist is” and “what the protagonist is doing”. So it would probably have a field storing “current location”, for example. It would also need a field specifying which entity (or entities?) that the protagonist is curretly using.</p></li>
<li><p>We would need an <strong>Inventory</strong> object that represents a collection of storable <strong>Entity</strong> objects that the protagonist carries with them from one location to another. The inventory object would be responsible for actions associated with its contents: if if the character is carrying too many objects it should signal that the inventory is full and require the player to drop objects before taking any other action.</p></li>
<li><p>We would need a data structure to represent a <strong>Location</strong>. A location could be a room in a house, or a district in a town, or something like that. Locations are permitted to contain other locations: for instance, a game could include a “neighbourhood” location that contains many “house” locations, and each house could have several “room” locations. Locations would need to have a description to be presented to the user, and they could have field listing a set of <strong>Entity</strong> objects that exist at the location, and with which the protagonist could interact. Each location would also need to specify which other locations the protagonist could move to upon leaving this location. In order to handle these contingencies, the location itself would need to contain one or more <strong>Action</strong> objects.</p></li>
<li><p>The <strong>Entity</strong> class would be a high level class. A basic entity is would be something akin to an object that exist within a location. This can include “storeable” entities like books, which can exist inside a location but can also be stored in the inventory, as well as “non-storeable” entities like fountains that can exist in a location but cannot be placed in the inventory. As such every entity would need to have a “location” field that could refer either to an actual <strong>Location</strong> but it could refer to the <strong>Inventory</strong>. This field allows each entity to know where it is. Entities would also need to have a boolean “is_visible” field or something like that. Upon entering a location, only the visible entities would be made available for the user to interact with. Invisible entities stay invisible until some <strong>Action</strong> triggers them to change state. More generally, each entity would be associated with some set of <strong>Action</strong> objects that specify the way in which the protagonist can interact wit the entity.</p></li>
<li><p>An <strong>AgentEntity</strong> (presumably a subclass of <strong>Entity</strong>) is an entity that has all the characteristics of any other <strong>Entity</strong> but additionally has methods and fields that provide it with “agent-like” attributes. It may be possible to talk to an agent or engage in combat with them. So a “Goblin” might have health statistics much like the protagonist, and could engage in combat with the protagonist. If the entity is something the protagonist can talk to, the entity would need a store a dialogue tree.</p></li>
</ul>
<p>On top of this we need objects and systems to govern the flow between game states and handle interactions between the protagonist, entities, and locations. Let’s start thinking about what this looks like:</p>
<ul>
<li>An <strong>Action</strong> object is a thing that attaches either to an <strong>Entity</strong> or a <strong>Location</strong> and specifies a way in which the protagonist can interact with the entity/location. There would likely be many subclasses here.</li>
</ul>
<p>I’m not certain precisely what action types would be needed here, but</p>
<ul>
<li><p><strong>StoreAction</strong>: this would allow an entity to be removed from the current location and added to the inventory. When the <strong>StoreAction</strong> is called it would automatically create a new <strong>DropAction</strong> associated with the relevant entity, and then destroys itself. This would prevent the game from letting the user try to store an object that is already in the inventory.</p></li>
<li><p><strong>DropAction</strong>: this would allow an entity currently in the inventory to be removed from the inventory and added to the location where the protagonist currently is. When called, it would add a <strong>StoreAction</strong> to the relevant entity, and then destroy itself. If the entity is currently in use, it would trigger the relevant “unuse” action before doing so.</p></li>
<li><p><strong>TravelAction</strong>: this would in the typical case, be associated with a specific location. When invoked, a <strong>TravelAction</strong> would move the protagonist to a different location. In doing so it would have to update the “current location” field for the protagonist, and invoke the <strong>LocationInteraction</strong> system for that new location. Though typically associated with locations, we wouldn’t forbid entities from possessing a <strong>TravelAction</strong>. For instance, a fountain entity might double as a teleporter that moves the protagonist to a new location.</p></li>
<li><p><strong>EntryAction</strong>: this would be automatically invoked when the protagonist first enters a location (e.g., this could be used to trigger a trap when the protagonist enters a room)</p></li>
<li><p><strong>ExitAction</strong>: analogous to <strong>EntryAction</strong>, it is automatically invoked when the protagonist leaves the location.</p></li>
<li><p><strong>InspectAction</strong>: at a minimum, this trigger a new description to be presented to the user. But it might also lead to one or more entity objects being revealed (e.g., the <strong>InspectAction</strong> for a bookcase might invoke the <strong>RevealAction</strong> for a book). If the <strong>InspectAction</strong> has consequences like that, it’s likely that it would need to destroy itself after the inspection has taken place.</p></li>
<li><p><strong>RevealAction</strong>: this would set the is_visible field of an entity true</p></li>
<li><p><strong>HideAction</strong>: this would set the is_visible field of an entity to false</p></li>
<li><p><strong>CombatAction</strong>: this would induce a <strong>CombatInteraction</strong> between the protagonist and the entity</p></li>
<li><p><strong>TalkAction</strong>: this would induce a <strong>TalkInteraction</strong> between the protagonist and the entity</p></li>
<li><p><strong>UseAction</strong>: this would invoke some entity-specific change in the protagonist state (e.g., increasing health). It would then have other side effects. For example, if it’s a single-use object (e.g., a health potion), then calling the <strong>UseAction</strong> would call the <strong>DestroyAction</strong> for the entity. If it’s a persistent object (e.g., a book), the <strong>UseAction</strong> would (a) update the protagonists “currently using” field to refer to the entity; (b) create an <strong>UnuseAction</strong> for the entity and; (c) destroy itself. Optionally: if there’s already an in-use entity, it would need to trigger the <strong>UnuseAction</strong> for the currently-in-use entity before taking steps (a-c).</p></li>
<li><p><strong>UnuseAction</strong>: object would reverse the entity-specific changes in state associated with a persistent in-use object. It would (a) reset the “currently using” field for the protagonist to an empty value, (b) create a <strong>UseAction</strong> for the entity, and (c) destroy itself.</p></li>
<li><p><strong>DestroyAction</strong>: is invoked whenever the relevant entity is destroyed. In the simplest case, it destroys the entity object. It may have some other side effects though: it could reveal new objects, for instance. Killing the “Goblin” entity in combat would call its <strong>DestroyAction</strong>. This <strong>DestroyAction</strong> might invoke the <strong>RevealAction</strong> for the “Goblin Sword” that the goblin had been using. By revealing the sword, the user can pick it up (i.e., invoke the <strong>StoreAction</strong> for the “Goblin Sword”).</p></li>
</ul>
<p>Thinking about actions in this sense makes clear that we probably need several qualitative different <strong>Interaction</strong> systems:</p>
<ul>
<li><p><strong>LocationInteraction</strong>: this system would be responsible for interactions with location. It presents the user with a description of the place and offers a set of actions based on whatever is contained in that place. It would also accept responses from the user, and trigger the appropriate actions. Depending on what the user does, this might then hand over to the entity interaction system, for instance.</p></li>
<li><p><strong>InventoryInteraction</strong>: this system would be responsible for interactions with the inventory. It would show the user a list of entities currently stored, allow the user to select entities, drop them, destroy them, use them, etc.</p></li>
<li><p><strong>EntityInteraction</strong>: this system would take an entity, present the user with a description, and offer actions associated with that entity. Again, it would accept responses from the user and trigger appropriate actions. This might in turn trigger the combat or dialog interaction systems.</p></li>
<li><p><strong>CombatInteraction</strong>: this would be a turn-based system that governs how the protagonist can fight an <strong>AgentEntity</strong>. You can only enter combat if the agent possesses a <strong>CombatAction</strong>. This system would need a random-number generation system, some notion of attack strength, and perhaps include its own set of combat-specific actions like: <strong>Attack</strong>, <strong>Defend</strong>, <strong>Flee</strong>, etc. It would also allow the protagonist to call the <strong>UseAction</strong> for an item stored in the <strong>Inventory</strong> (e.g., using a “health potion” would increase health and then destroy the potion). Each combat action would modify the state of both the protagonist and the entity. Combat would end only when either the protagonist or the entity is destroyed/dead. A dead protagonist ends the game. A dead/destroyed entity triggers the relevant <strong>DestroyAction</strong>.</p></li>
<li><p><strong>TalkInteraction</strong>: this would also be a turn-based system that manages the dialogue options that associated with an <strong>AgentEntity</strong>. I’m not quite sure what that looks like yet, but presumably it would invoke a dialog tree associated with the agent.</p></li>
</ul>
<p>Things are starting to take shape, but we still have some more to consider. The <strong>Interaction</strong> systems are part of the game mechanic. They describe how the protagonist interacts with other things in the game world. However, when I wrote about these systems above I talked about it as if the protagonist and the user are the same thing. They aren’t, so we’ll also need this:</p>
<ul>
<li><strong>UserInterface</strong>: this system would take care of the actual “displaying stuff to the user” and the “reading responses from the user” part. It would also handle things like “giving the user the option to exit the game”, and also “displaying the game state” (e.g., “You are talking to a Goblin, in the Library”)</li>
</ul>
<p>Pushing further, if we’re thinking of this as a simple game engine, then we’ll need some additional mechanisms:</p>
<ul>
<li><strong>GameLoad</strong>: this would have the ability to read a game state from a JSON file or something.</li>
<li><strong>GameSave</strong>: this would have the ability to write a game state to file.</li>
</ul>
<p>In a fancy world you’d separate the “game file” from a specific “save game file”, but this setup is so simple that you might as well write everything to the save file. In this sense, a “game file” is exactly identical to the “save game file” corresponding to the initial game state.</p></div>
            <div class="d-none d-xl-block col-xl-2 bd-toc">
               <ul class="section-nav">
                  <li class="toc-entry"><ul>
<li><a href="#chapter-summary">Chapter summary</a></li>
<li><a href="#an-informal-sketch">An informal sketch</a></li>
</ul></li>
               </ul>
            </div>
         </div>
               </div>
            <!-- JS, Popper.js, and jQuery -->
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
      <!-- Mathjax -->
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script>
         /* Bootstrap styles to tables */
         function bootstrapStylePandocTables() {
         $('tr.header').parent('thead').parent('table').addClass('table table-condensed'); }
         $(document).ready(function () { bootstrapStylePandocTables(); });
         /* Adjust the height when click the toc */
         var shiftWindow = function() { scrollBy(0, -60) };
         window.addEventListener("hashchange", shiftWindow);
         function load() { if (window.location.hash) shiftWindow(); }
      </script>
   </body>
</html>
